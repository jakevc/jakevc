<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>New GATK 4.0 | Jake VanCampen</title>


<link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/syntax.css"><link rel='stylesheet' href='/css/custom.css'><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
<link rel="manifest" href="/favicon/site.webmanifest">
<link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#fffff">
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>


<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="/"><h1 class="title is-4">Jake VanCampen</h1></a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile"><a class="level-item" aria-label="email" href='mailto:jake.vancampen7@gmail.com' target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
    <polyline points="22,6 12,13 2,6"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="github" href='https://github.com/jakevc' target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="linkedin" href='https://linkedin.com/in/jakevancampen' target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path stroke-width="1.8" d="m5.839218,4.101561c0,1.211972 -0.974141,2.194011 -2.176459,2.194011s-2.176459,-0.982039 -2.176459,-2.194011c0,-1.211094 0.974141,-2.194011 2.176459,-2.194011s2.176459,0.982917 2.176459,2.194011zm0.017552,3.94922l-4.388022,0l0,14.04167l4.388022,0l0,-14.04167zm7.005038,0l-4.359939,0l0,14.04167l4.360816,0l0,-7.370999c0,-4.098413 5.291077,-4.433657 5.291077,0l0,7.370999l4.377491,0l0,-8.89101c0,-6.915523 -7.829986,-6.66365 -9.669445,-3.259423l0,-1.891237z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="twitter" href='https://twitter.com/jake_vancampen' target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      
        <div class="nav-left"><a class="nav-item" href="/bio">
                <h2 class="title is-5">Bio</h2>
              </a><a class="nav-item" href="/cv">
                <h2 class="title is-5">CV</h2>
              </a></div>
      

      
    </nav>

  </div>
</section>

<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="/tags/gatk">#gatk</a>



  
  | <a class="subtitle is-6" href="/tags/software">#software</a>
  
  | <a class="subtitle is-6" href="/tags/news">#news</a>
  
  | <a class="subtitle is-6" href="/tags/gccbosc">#gccbosc</a>
  

      
    </div>
    <h2 class="subtitle is-6">June 26, 2018</h2>
    
    <div class="content">
      

<h2 id="what-s-new-in-gatk-4-0">What&rsquo;s new in GATK 4.0</h2>

<ul>
<li>Catered to illumina short read sequencing</li>
<li>Pre-processing, variant analysis.</li>
<li>Goal is to identify variation between genomes</li>
</ul>

<p>GATK 4.0 was rewritten from scratch for dramatic performance improvements and new functional capabilities such as:</p>

<ul>
<li>structural variant detection</li>
<li>advanced machine learning techniques</li>
<li>best-practice workflows</li>
<li>All Picard tools bundled in GATK executable
<br /></li>
</ul>

<h2 id="speed-optimizations">Speed optimizations</h2>

<ul>
<li><p>Intel genomics kernal library (GKL) increased spead and hardware optimizations.</p></li>

<li><p>GenomicsDB increases scalability, becasue speed is not enough!</p></li>

<li><p>Apache Spark support allows for robust parallelism, replaces the (nt/nct Gatk).</p></li>

<li><p>Picard tools greatly benifit from Apache spark.</p></li>
</ul>

<h2 id="pipeline-standardization">Pipeline Standardization</h2>

<ul>
<li>Want to develope <em>functional equivalence</em> accross studies to eliminae batch effects</li>
<li>Reduce cost of pipeline</li>
<li>Reduce heterogeneity of implimentations</li>
</ul>

<p>Most best practices workflows are available in Workflow development language.</p>

<p>The cost of processing one whole genome has dropped from $45 in 2016, to $5 today on a google cloud platform.</p>

<p>Google cloud can stream smaller bits of data for the analysis to allow for faster copy and cost of data storage.</p>

<h2 id="workshop-examples">Workshop examples</h2>

<p>The workshop bundle was downloaded from google drive:</p>

<p><a href="https://drive.google.com/drive/folders/1U6Zm_tYn_3yeEgrD1bdxye4SXf5OseIt?usp=sharing" target="_blank">https://drive.google.com/drive/folders/1U6Zm_tYn_3yeEgrD1bdxye4SXf5OseIt?usp=sharing</a></p>

<p>Grab the docker image:
<code>docker pull broadinstitute/gatk:4.0.5.1</code></p>

<p>Spin up the container, and mount the location of the data bundle inside the docker.</p>

<p><code>docker run -v /path/gatk_data:/gatk/gatk_data -it broadinstitute/gatk:4.0.5.1</code></p>

<p>GATK can be called by running <code>gatk</code> from the command line followed by the tool name, e.g.: <code>gatk HaplotypeCaller --help</code></p>

<h2 id="gatk">GATK</h2>

<p>Run a full GATK4 command:</p>

<p><code>gatk HaplotypeCaller -R ref/ref.fasta -I bams/mother.bam -O sandbox/variants.vcf</code></p>
<div class="highlight"><pre class="chroma">3:27:43.064 INFO  ProgressMeter -          20:63024713              0.5                210982         391142.0
23:27:43.064 INFO  ProgressMeter - Traversal complete. Processed 210982 total regions in 0.5 minutes.
23:27:43.089 INFO  VectorLoglessPairHMM - Time spent in setup for JNI call : 0.0241793
23:27:43.089 INFO  PairHMM - Total compute time in PairHMM computeLogLikelihoods() : 4.6333234
23:27:43.090 INFO  SmithWatermanAligner - Total compute time in java Smith-Waterman : 3.63 sec
23:27:43.090 INFO  HaplotypeCaller - Shutting down engine
[June 26, 2018 11:27:43 PM UTC] org.broadinstitute.hellbender.tools.walkers.haplotypecaller.HaplotypeCaller done. Elapsed time: 0.57 minutes.
Runtime.totalMemory()=218103808</pre></div>
<h2 id="picard">Picard</h2>

<p>Run a Picard Command!</p>

<p><code>gatk ValidteSamFile -I bams/mother.bam -MODE SUMMARY</code></p>

<p>The command outputs the following:</p>
<div class="highlight"><pre class="chroma">## HISTOGRAM	java.lang.String
Error Type	Count
ERROR:MATE_NOT_FOUND	77

[Tue Jun 26 23:36:02 UTC 2018] picard.sam.ValidateSamFile done. Elapsed time: 0.03 minutes.
Runtime.totalMemory()=195035136
To get help, see http://broadinstitute.github.io/picard/index.html#GettingHelp
Tool returned:
3</pre></div>
<h2 id="spark">Spark</h2>

<p>Run command with Spark multithreading:</p>
<div class="highlight"><pre class="chroma">gatk --java-options &#34;-Xmx6G&#34; MarkDuplicatesSpark \
  -R ref/ref.fasta \
  -I bams/mother.bam \
  -O sandbox/mother_dedup.bam \
  -M sandbox/metrics.txt \
  -- \ # spark library convention to setoff spark options
  --spark-master local[*]</pre></div>
<p>The <code>[*]</code> could be replaced by a desired number of cores (* requests all available)</p>

<p>Two output files were created:</p>
<div class="highlight"><pre class="chroma"> mother_dedup.bam  mother_dedup.bam.splitting-bai </pre></div>
<p>The file extension .splitting-bai shows evidence of how spark may break up the bam file to execute on multiple cores.</p>

<h2 id="gcloud">GCLOUD</h2>

<p>To run the same command on a GCLOUD instance, because the docker image has the gcloud binary, we initalize the instance by typing:</p>

<p><code>gcloud init</code></p>

<p>then setup a jar cache so that the jar file doesn&rsquo;t have to be re-uploaded:
export GATK_GCS_STAGING=gs://gatk-jar-cache/</p>

<p>The same command line can then be called on dataproc</p>
<div class="highlight"><pre class="chroma">gatk --java-options &#34;-Xmx6G&#34; MarkDuplicatesSpark \
  -R gs://gatk-workshops/GCCBOSC2018/ref/ref.fasta \
  -I gs://gatk-workshops/GCCBOSC2018/bams/mother.bam \
  -O gs://my-output/sandbox/mother_dedup.bam \
  -M gs://my-output/sandbox/metrics.txt \
  -- \ # spark library convention to setoff spark options
  --spark-runner GCS \
  --cluster [cluster name]</pre></div>
<p>Notice the different paths, they point to where the data was copied to on google cloud.
Geraldine talked about their use of google cloud for all their computing. All sequencing data is uploaded to the cloud as unstructured bams, and analyzed from there. Once data is generated it can be shunted to deep storage. All upload is free, download costs money.</p>

<h2 id="four-classes-of-variation">Four classes of variation</h2>

<ul>
<li>SNP/SNV</li>
<li>INDEL</li>
<li>Copy Number (CNV)</li>
<li>Structural Variation (SV)
<br />
<br /></li>
</ul>

<h2 id="germline-short-variant-discovery">Germline Short Variant Discovery</h2>

<ul>
<li>pre-processing</li>
<li>per-sample variant calling</li>
</ul>

<p>New tool &ldquo;Funcotator&rdquo; will predict variant effects based on annotation files.</p>

<h2 id="wdl">WDL</h2>

<p>All best practices workflows are available at github.com/gatk-workflows, they are written in wdl.</p>

<h2 id="firecloud">Firecloud</h2>

<p>Broad designed system for pipeline analysis, and collaboration built on google cloud. Firecloud now supports jupyter notebooks so you can go do downstream analyses on the cloud also.</p>

<p>Hail is a genomic analysis framework for downstream analyses in jupyter notebooks. This allows for th</p>

<h2 id="best-practices-workflows">Best Practices Workflows</h2>

<p>GATK 4.0 best practice workflows are hosted on <a href="https://github.com/gatk-workflows/" target="_blank">github</a>.</p>

      
      <div class="related">

<h3>Similar articles:</h3>
<ul>
	
	<li><a href="/post/intro-to-galaxy/">Intro to galaxy admin</a></li>
	
</ul>
</div>
      
    </div>
    
  </div>
</section>

<section class="section">
  <div class="container">
    <aside><div id="disqus_thread"></div></aside>
    <script type="text/javascript">
      var disqus_shortname = 'jakevc';
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>
</section>


<section class="section">
  <div class="container has-text-centered">
    <p></p>
    
  </div>
</section>

<script src="//yihui.name/js/math-code.js"></script>
<script async
src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


</body>
</html>

